<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.fluorescent.fluorescentmusic.dao.ArtistDao">
    <resultMap id="artistResultMap" type="cn.fluorescent.fluorescentmusic.entity.Artist">
        <id column="id" property="id"/>
        <result column="created_time" property="createdTime"/>
        <result column="updated_time" property="updatedTime"/>
        <result column="name" property="name"/>
        <result column="remark" property="remark"/>
        <result column="photo_url" property="photoUrl"/>
        <result column="status" property="status"/>
        <result column="recommended" property="recommended"/>
        <result column="recommend_factor" property="recommendFactor"/>
        <collection property="createdBy" column="id" javaType="cn.fluorescent.fluorescentmusic.entity.User"
                    select="findUserByCreatedId"/>
        <collection property="updatedBy" column="id" javaType="cn.fluorescent.fluorescentmusic.entity.User"
                    select="findUserByUpdatedId"/>
        <collection property="musicList" javaType="java.util.ArrayList"
                    ofType="cn.fluorescent.fluorescentmusic.entity.Music"
                    select="findMusicList" column="id"/>
    </resultMap>

    <select id="findUserByCreatedId" resultMap="cn.fluorescent.fluorescentmusic.dao.UserDao.userResultMap">
        SELECT *
        FROM `user`
        WHERE id IN (SELECT created_by_user_id AS id
                     FROM `artist`
                     WHERE `artist`.id = #{id})
    </select>
    <select id="findUserByUpdatedId" resultMap="cn.fluorescent.fluorescentmusic.dao.UserDao.userResultMap">
        SELECT *
        FROM `user`
        WHERE id IN (SELECT updated_by_user_id AS id
                     FROM `artist`
                     WHERE `artist`.id = #{id})
    </select>
    <select id="findMusicList" resultMap="cn.fluorescent.fluorescentmusic.dao.MusicDao.musicResultMap">
        SELECT *
        FROM music
        WHERE id IN (SELECT music_id as id
                     FROM `artist_music`,
                          `artist`
                     WHERE artist_music.artist_id = artist.id
                       AND `artist`.id = #{id});

    </select>
</mapper>